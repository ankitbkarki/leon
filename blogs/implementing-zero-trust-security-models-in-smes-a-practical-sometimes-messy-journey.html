<!DOCTYPE html><html lang="en-us"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Zero Trust Implementation in SMEs: A Practical Guide</title><meta name="description" content="Learn how small and medium-sized enterprises (SMEs) can implement a Zero Trust security model realistically and effectively — without breaking the bank or overhauling their entire IT infrastructure."><meta name="generator" content="Publii Open-Source CMS for Static Site"><script type="text/javascript" async src="https://www.googletagmanager.com/gtag/js?id=G-1YSV5NS6SN"></script><script type="text/javascript">window.dataLayer = window.dataLayer || [];
				  function gtag(){dataLayer.push(arguments);}
				  gtag('js', new Date());
				  gtag('config', 'G-1YSV5NS6SN' );</script><link rel="canonical" href="https://leonstaff.com/blogs/implementing-zero-trust-security-models-in-smes-a-practical-sometimes-messy-journey.html"><link rel="alternate" type="application/atom+xml" href="https://leonstaff.com/blogs/feed.xml" title="Leon Consulting Blog - RSS"><link rel="alternate" type="application/json" href="https://leonstaff.com/blogs/feed.json" title="Leon Consulting Blog - JSON"><meta property="og:title" content="Implementing Zero Trust Security Models in SMEs: A Practical, Sometimes Messy Journey"><meta property="og:image" content="https://leonstaff.com/blogs/media/posts/6/Implementing-Zero-Trust-Security-Models-in-SMEs.webp"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="675"><meta property="og:site_name" content="Leon Consulting Blog"><meta property="og:description" content="Learn how small and medium-sized enterprises (SMEs) can implement a Zero Trust security model realistically and effectively — without breaking the bank or overhauling their entire IT infrastructure."><meta property="og:url" content="https://leonstaff.com/blogs/implementing-zero-trust-security-models-in-smes-a-practical-sometimes-messy-journey.html"><meta property="og:type" content="article"><link rel="preload" href="https://leonstaff.com/blogs/assets/dynamic/fonts/inter/inter.woff2" as="font" type="font/woff2" crossorigin><link rel="preload" href="https://leonstaff.com/blogs/assets/dynamic/fonts/inter/inter-italic.woff2" as="font" type="font/woff2" crossorigin><link rel="stylesheet" href="https://leonstaff.com/blogs/assets/css/style.css?v=7ddcc1993dc40afaced990f8f62028c4"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://leonstaff.com/blogs/implementing-zero-trust-security-models-in-smes-a-practical-sometimes-messy-journey.html"},"headline":"Implementing Zero Trust Security Models in SMEs: A Practical, Sometimes Messy Journey","datePublished":"2025-04-29T06:16-05:00","dateModified":"2025-04-30T04:09-05:00","image":{"@type":"ImageObject","url":"https://leonstaff.com/blogs/media/posts/6/Implementing-Zero-Trust-Security-Models-in-SMEs.webp","height":675,"width":1200},"description":"Learn how small and medium-sized enterprises (SMEs) can implement a Zero Trust security model realistically and effectively — without breaking the bank or overhauling their entire IT infrastructure.","author":{"@type":"Person","name":"Leon","url":"https://leonstaff.com/blogs/authors/leon-staff-team/"},"publisher":{"@type":"Organization","name":"Leon","logo":{"@type":"ImageObject","url":"https://leonstaff.com/blogs/media/website/logo.png","height":100,"width":250}}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7656339654245336" crossorigin="anonymous"></script></head><body class="post-template"><header class="header" id="js-header"><a href="https://leonstaff.com/blogs/" class="logo"><img src="https://leonstaff.com/blogs/media/website/logo.png" alt="Leon Consulting Blog" width="250" height="100"></a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li><a href="https://leonstaff.com" target="_self">HOME</a></li><li><a href="https://leonstaff.com/#services" target="_self">SERVICES</a></li><li><a href="https://leonstaff.com/#about" target="_self">ABOUT</a></li><li><a href="https://leonstaff.com/#contact" target="_self">CONTACT</a></li><li><a href="https://leonstaff.com/#faq" target="_self">F&amp;Q</a></li></ul></nav></header><main class="post"><div class="wrapper"><article class="content"><header class="content__header"><a href="https://leonstaff.com/blogs/tags/cybersecurity/" class="content__maintag">Cybersecurity</a><h1 class="content__title">Implementing Zero Trust Security Models in SMEs: A Practical, Sometimes Messy Journey</h1><div class="content__posted-date"><time datetime="2025-04-29T06:16">April 29, 2025</time></div></header><figure class="content__featured-image"><img src="https://leonstaff.com/blogs/media/posts/6/Implementing-Zero-Trust-Security-Models-in-SMEs.webp" height="675" width="1200" alt="Implementing Zero Trust Security Models in SMEs"><figcaption>Implementing Zero Trust Security Models in SMEs</figcaption></figure><div class="content__inner"><div class="content__entry"><p data-start="309" data-end="823">Let’s be honest. “Zero Trust” sounds a bit... unforgiving. Like something a grumpy sysadmin might mutter under their breath after a particularly nasty data breach. But in reality, Zero Trust isn't about being paranoid or pessimistic — at least, not entirely. It's a practical response to how the digital landscape has evolved. And for small and medium-sized enterprises (SMEs), adopting a Zero Trust security model isn't just possible; it's increasingly necessary. Even if, at first glance, it seems like overkill.</p><p data-start="825" data-end="1285">Because here's the thing: SMEs often believe they’re too small to be targeted. That cyberattacks are something that happens to big banks or multinational corporations — you know, the companies with rows of servers and entire departments dedicated to infosec. But that’s a dangerously outdated mindset. In truth, attackers go where the defenses are weakest, and more often than not, that means smaller businesses with fewer resources and looser access policies.</p><p data-start="1287" data-end="1483">So, let’s talk about what Zero Trust is, why it matters for SMEs, and — perhaps more importantly — how you can actually start implementing it without getting buried in jargon or budgetary despair.</p><h3 data-start="1490" data-end="1525">The Core Idea Behind Zero Trust</h3><p data-start="1527" data-end="1625">At its heart, Zero Trust is built on a deceptively simple premise: <strong data-start="1594" data-end="1624">never trust, always verify</strong>.</p><p data-start="1627" data-end="1932">That means just because someone’s inside your network doesn’t mean they should have free rein. It means identity is not a one-and-done checkpoint. Instead, it needs to be continuously verified, monitored, and assessed. Every user, device, application — they all need to prove they belong, again and again.</p><p data-start="1934" data-end="2260">It’s a shift from the old perimeter-based security model, where everything inside the firewall was assumed to be safe. And, sure, that used to work reasonably well. But today? With cloud services, remote work, mobile devices, and increasingly sophisticated phishing attacks? That perimeter is more of a suggestion than a wall.</p><p data-start="2262" data-end="2536">In theory, Zero Trust sounds airtight. In practice, it's... complicated. Especially for SMEs, which often have limited budgets, overworked IT teams (if they have a dedicated team at all), and legacy systems that weren’t exactly built with modern security principles in mind.</p><p data-start="2538" data-end="2735">But — and this is crucial — Zero Trust isn't a product. It’s not something you buy and plug in. It’s a mindset. A gradual, adaptable approach. That’s what makes it doable for smaller organizations.</p><h3 data-start="2742" data-end="2801">Where to Begin (and Why Starting Small is Totally Fine)</h3><p data-start="2803" data-end="3102">The temptation, when hearing about Zero Trust from consultants or vendors, is to think you need to revamp your entire infrastructure all at once. Tear everything down, rebuild it with micro-segmentation, identity-based access, behavior monitoring, and... well, that’s overwhelming. Unrealistic, too.</p><p data-start="3104" data-end="3180">So start small. In fact, starting small is not just acceptable — it’s smart.</p><p data-start="3182" data-end="3371">Begin with the basics: <strong data-start="3205" data-end="3236">understand your environment</strong>. That might sound vague, but think of it as taking stock. What systems do you have? Who accesses them? From where? Using what devices?</p><p data-start="3373" data-end="3605">You don’t need a fancy tool to do this. Even a spreadsheet is fine, if that’s all you have. Map out your assets. Your users. Your data flows. It’s tedious, sure, but it’s foundational. You can’t protect what you don’t know you have.</p><p data-start="3607" data-end="3915">From there, one of the most accessible entry points into Zero Trust is <strong data-start="3678" data-end="3715">multi-factor authentication (MFA)</strong>. It’s not sexy. It’s not new. But it’s remarkably effective. And for SMEs, enabling MFA across cloud services like Microsoft 365 or Google Workspace is often just a matter of flipping a few switches.</p><p data-start="3917" data-end="4004">It’s the digital equivalent of locking your doors at night. Simple, but non-negotiable.</p><h3 data-start="4011" data-end="4079">Identity is the New Perimeter — But That’s Easier Said Than Done</h3><p data-start="4081" data-end="4271">Once you’ve started tightening access controls, it becomes obvious how much hinges on identity. Who is this user? Are they who they say they are? Should they even have access to this system?</p><p data-start="4273" data-end="4539">This is where things get a little fuzzy for SMEs. Many don’t have centralized identity systems. Maybe they’re using a patchwork of local logins, or shared accounts, or — let’s admit it — the same password across several platforms because it’s “just easier that way.”</p><p data-start="4541" data-end="4796">But to implement Zero Trust meaningfully, consolidating identity is key. Ideally, you want to move toward <strong data-start="4647" data-end="4671">single sign-on (SSO)</strong> with a unified identity provider. That could be Azure AD, Okta, Google Identity — whatever fits your environment and budget.</p><p data-start="4798" data-end="5132">Now, this is where the rubber meets the road. Because implementing SSO or IAM solutions often exposes just how inconsistent or outdated internal systems are. You find old accounts that were never deactivated. Scripts hardcoded with credentials. That one marketing tool nobody remembers setting up but everyone still kind of relies on.</p><p data-start="5134" data-end="5348">Don’t let that discourage you. These are normal growing pains. Fixing identity sprawl takes time. There’s no clean, linear path here — and anyone who tells you otherwise probably hasn’t done it in a real-world SME.</p><h3 data-start="5355" data-end="5415">Micro-Segmentation: Useful, But Don’t Let It Consume You</h3><p data-start="5417" data-end="5706">You’ll hear a lot about micro-segmentation when researching Zero Trust. The idea is to divide your network into smaller segments, so that even if an attacker gets in, they can’t move freely. Like having multiple compartments in a ship — if one gets breached, the whole thing doesn’t flood.</p><p data-start="5708" data-end="5820">And yes, it’s important. But it’s also hard to do well, especially if you don’t have network engineers on staff.</p><p data-start="5822" data-end="6044">So here’s a more approachable interpretation: think in terms of <strong data-start="5886" data-end="5912">least privilege access</strong>. Not every employee needs access to every system. Your finance team doesn’t need the same tools as your developers. And vice versa.</p><p data-start="6046" data-end="6351">Start applying role-based access control (RBAC) where you can. Review permissions regularly. Question default settings. It's okay if you're not ready to deploy full network segmentation tools right away — simply tightening access policies and removing unnecessary privileges gets you 80% of the way there.</p><p data-start="6353" data-end="6480">Honestly, I’ve seen SMEs make huge gains just by cleaning up their Active Directory groups. No fancy tech, just better hygiene.</p><h3 data-start="6487" data-end="6540">Monitoring and Visibility: The Eyes of Zero Trust</h3><p data-start="6542" data-end="6733">Here’s where things get a little more abstract. Zero Trust depends heavily on visibility. If you're going to “never trust, always verify,” you need a way to actually observe what's happening.</p><p data-start="6735" data-end="6868">Are users behaving normally? Is that connection from Brazil at 2 a.m. really your accountant on vacation, or something else entirely?</p><p data-start="6870" data-end="7057">Now, full-blown Security Information and Event Management (SIEM) platforms might be overkill for some SMEs — both in terms of cost and complexity. But basic monitoring is still essential.</p><p data-start="7059" data-end="7277">Most cloud services now offer some form of activity logging. Start there. Turn on alerts for suspicious logins. Review admin actions. Even setting up automated reports that you check weekly is better than flying blind.</p><p data-start="7279" data-end="7493">And here’s something often overlooked: train your employees to notice odd behavior, too. Sometimes the best early warning system is a team member who says, “Hey, I got a weird login alert yesterday — was that you?”</p><p data-start="7495" data-end="7574">Don’t underestimate that kind of casual vigilance. It’s surprisingly effective.</p><h3 data-start="7581" data-end="7628">Culture Change: The Soft Side of Zero Trust</h3><p data-start="7630" data-end="7774">Now, all of this — identity controls, MFA, visibility — it’s technical. But Zero Trust isn’t just a technical initiative. It’s a cultural shift.</p><p data-start="7776" data-end="7950">You’re asking people to work differently. To verify more often. To deal with more prompts, more approvals, more barriers. That can feel annoying. Frustrating. Even insulting.</p><p data-start="7952" data-end="8260">So communication is key. Help your team understand why these changes matter. Share stories (real ones, if possible) about phishing scams, data breaches, ransomware attacks. Make it relatable. Frame security not as an obstacle, but as a form of care — both for the business and the people who keep it running.</p><p data-start="8262" data-end="8489">And be ready to compromise. Not every control will be accepted without pushback. Some may need tweaking. That’s okay. Perfect security doesn’t exist, and you’ll burn out your team — and probably yourself — trying to enforce it.</p><h3 data-start="8496" data-end="8553">Tools, Vendors, and the Reality of Budget Constraints</h3><p data-start="8555" data-end="8675">There’s no shortage of vendors promising to make Zero Trust easy. Some of them are genuinely helpful. Others... less so.</p><p data-start="8677" data-end="8938">For SMEs, the trick is prioritizing tools that offer real value without locking you into rigid ecosystems or complex licensing. Look for interoperability. Look for scalability. Avoid tools that try to be everything — those tend to be expensive and underdeliver.</p><p data-start="8940" data-end="8969">A few categories to consider:</p><ul data-start="8971" data-end="9268"><li data-start="8971" data-end="9045"><p data-start="8973" data-end="9045"><strong data-start="8973" data-end="9014">Cloud Access Security Brokers (CASBs)</strong> if you use a lot of SaaS tools</p></li><li data-start="9046" data-end="9106"><p data-start="9048" data-end="9106"><strong data-start="9048" data-end="9089">Endpoint Detection and Response (EDR)</strong> for your devices</p></li><li data-start="9107" data-end="9216"><p data-start="9109" data-end="9216"><strong data-start="9109" data-end="9129">VPN alternatives</strong> like ZTNA (Zero Trust Network Access) solutions — think Tailscale or Cloudflare Access</p></li><li data-start="9217" data-end="9268"><p data-start="9219" data-end="9268"><strong data-start="9219" data-end="9236">IAM platforms</strong> with strong MFA and SSO options</p></li></ul><p data-start="9270" data-end="9365">But again — don’t get caught up in tool-chasing. Zero Trust is a strategy, not a shopping list.</p><h3 data-start="9372" data-end="9432">Common Pitfalls (and Why You Might Run Into Them Anyway)</h3><p data-start="9434" data-end="9598">It’s probably worth admitting that even with all the planning and good intentions in the world, your Zero Trust implementation won’t be perfect. Some common issues:</p><ul data-start="9600" data-end="9919"><li data-start="9600" data-end="9657"><p data-start="9602" data-end="9657"><strong data-start="9602" data-end="9623">Over-complication</strong>: Trying to do too much, too fast.</p></li><li data-start="9658" data-end="9737"><p data-start="9660" data-end="9737"><strong data-start="9660" data-end="9683">Under-communication</strong>: Rolling out new restrictions without explaining why.</p></li><li data-start="9738" data-end="9810"><p data-start="9740" data-end="9810"><strong data-start="9740" data-end="9756">Tool fatigue</strong>: Buying software without a clear implementation path.</p></li><li data-start="9811" data-end="9919"><p data-start="9813" data-end="9919"><strong data-start="9813" data-end="9836">Neglected endpoints</strong>: Forgetting that remote or personal devices often bypass all your clever controls.</p></li></ul><p data-start="9921" data-end="10051">These mistakes happen. The important part is recognizing them early and adjusting course. Perfection is not the goal. Progress is.</p><h3 data-start="10058" data-end="10125">Final Thoughts (Which, Honestly, Might Contradict Earlier Ones)</h3><p data-start="10127" data-end="10345">Zero Trust is a powerful model. It’s flexible, robust, and — when done right — surprisingly intuitive. But it’s also messy in practice. Especially for SMEs trying to balance growth, costs, and a dozen other priorities.</p><p data-start="10347" data-end="10632">And that’s fine. You don’t have to do it all at once. You don’t even have to get it all “right.” Start with what you can control. Tweak it as you go. Listen to your team. Celebrate small wins. Ignore the jargon-heavy whitepapers that make you feel like you're always five steps behind.</p><p data-start="10634" data-end="10768">Security isn’t a destination — it’s a moving target. And Zero Trust, for all its technical depth, is really just a smarter way to aim.</p></div><footer><p class="content__last-updated"><time datetime="2025-05-01T05:51">This article was updated on May 1, 2025</time></p><nav class="content__nav"><div class="content__nav__prev"><a class="content__nav__link" href="https://leonstaff.com/blogs/top-cybersecurity-threats-in-2025.html" rel="prev">Previous Post<h3 class="h6">Top Cybersecurity Threats in 2025</h3></a></div><div class="content__nav__next"><a class="content__nav__link" href="https://leonstaff.com/blogs/best-cybersecurity-stocks-in-may-2025-whats-worth-watching-now.html" rel="prev">Next Post<h3 class="h6">Best Cybersecurity Stocks in May 2025: What’s Worth Watching Now</h3></a></div></nav></footer></div></article></div></main><footer class="footer"><nav><ul class="footer__nav"><li class="footer__nav-item"><a href="https://leonstaff.com" target="_self">HOME</a></li><li class="footer__nav-item"><a href="https://leonstaff.com/#services" target="_self">SERVICES</a></li><li class="footer__nav-item"><a href="https://leonstaff.com/#about" target="_self">ABOUT</a></li><li class="footer__nav-item"><a href="https://leonstaff.com/#contact" target="_self">CONTACT</a></li><li class="footer__nav-item"><a href="https://leonstaff.com/#faq" target="_self">F&amp;Q</a></li></ul></nav><div class="footer__copyright">Powered by Leon Consulting Corporation</div></footer><script>window.publiiThemeMenuConfig = {    
      mobileMenuMode: 'sidebar',
      animationSpeed: 300,
      submenuWidth: 'auto',
      doubleClickTime: 500,
      mobileMenuExpandableSubmenus: true, 
      relatedContainerForOverlayMenuSelector: '.navbar',
   };</script><script defer="defer" src="https://leonstaff.com/blogs/assets/js/scripts.min.js?v=1b09dc64eb6086ddc9720890661ff038"></script><div class="pcb" data-behaviour="badge" data-behaviour-link="#cookie-settings" data-revision="1" data-config-ttl="90" data-debug-mode="false"><div role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="pcb-title" aria-describedby="pcb-txt" class="pcb__banner"><div class="pcb__inner"><div id="pcb-title" role="heading" aria-level="2" class="pcb__title">This website uses cookies</div><div id="pcb-txt" class="pcb__txt">Select which cookies to opt-in to via the checkboxes below; our website uses cookies to examine site traffic and user activity while on our site, for marketing, and to provide social media functionality. <a href="#not-specified">More details...</a></div><div class="pcb__buttons"><button type="button" class="pcb__btn pcb__btn--link pcb__btn--configure" aria-haspopup="dialog">Manage preferences</button> <button type="button" class="pcb__btn pcb__btn--solid pcb__btn--accept">Accept all</button></div></div></div><div class="pcb__popup" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="pcb-popup-title"><div class="pcb__popup__wrapper"><div class="pcb__inner pcb__popup__inner"><div class="pcb__popup__heading"><div id="pcb-popup-title" role="heading" aria-level="2" class="pcb__title">Cookie settings</div><button class="pcb__popup__close" aria-label="Close"></button></div><div class="pcb__popup__content"><div class="pcb__txt pcb__popup__txt">We use cookies to enhance your browsing experience, serve personalized ads or content, and analyze our traffic. By clicking "Accept All", you consent to our use of cookies. <a href="#not-specified">More details...</a></div><ul class="pcb__groups"><li class="pcb__group"><details><summary class="pcb__group__title no-desc">Required</summary></details><div class="pcb__popup__switch is-checked"><input type="checkbox" data-group-name="" id="pcb-group-0" checked="checked"> <label for="pcb-group-0">Required</label></div></li></ul></div><div class="pcb__buttons pcb__popup__buttons"><button type="button" class="pcb__btn pcb__btn--solid pcb__btn--accept">Accept all</button> <button type="button" class="pcb__btn pcb__btn--reject">Reject all</button> <button type="button" class="pcb__btn pcb__btn--save">Save settings</button></div></div></div></div><div class="pcb__overlay" aria-hidden="true"></div><button class="pcb__badge" aria-label="Cookie Policy" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" width="40" height="40" viewBox="0 0 23 23" fill="currentColor"><path d="M21.41 12.71c-.08-.01-.15 0-.22 0h-.03c-.03 0-.05 0-.08.01-.07 0-.13.01-.19.04-.52.21-1.44.19-2.02-.22-.44-.31-.65-.83-.62-1.53a.758.758 0 0 0-.27-.61.73.73 0 0 0-.65-.14c-1.98.51-3.49.23-4.26-.78-.82-1.08-.73-2.89.24-4.49.14-.23.14-.52 0-.75a.756.756 0 0 0-.67-.36c-.64.03-1.11-.1-1.31-.35-.19-.26-.13-.71-.01-1.29.04-.18.06-.38.03-.59-.05-.4-.4-.7-.81-.66C5.1 1.54 1 6.04 1 11.48 1 17.28 5.75 22 11.6 22c5.02 0 9.39-3.54 10.39-8.42.08-.4-.18-.78-.58-.87Zm-9.81 7.82c-5.03 0-9.12-4.06-9.12-9.06 0-4.34 3.05-8 7.25-8.86-.08.7.05 1.33.42 1.81.24.32.66.67 1.38.84-.76 1.86-.65 3.78.36 5.11.61.81 2.03 2 4.95 1.51.18.96.71 1.54 1.18 1.87.62.43 1.38.62 2.1.62.05 0 .09 0 .13-.01-1.23 3.64-4.7 6.18-8.64 6.18ZM13 17c0 .55-.45 1-1 1s-1-.45-1-1 .45-1 1-1 1 .45 1 1Zm5.29-12.3a.99.99 0 0 1-.29-.71c0-.55.45-.99 1-.99a1 1 0 0 1 .71.3c.19.19.29.44.29.71 0 .55-.45.99-1 .99a1 1 0 0 1-.71-.3ZM9 13.5c0 .83-.67 1.5-1.5 1.5S6 14.33 6 13.5 6.67 12 7.5 12s1.5.67 1.5 1.5Zm3.25.81a.744.744 0 0 1-.06-1.05c.28-.32.75-.34 1.05-.06.31.28.33.75.05 1.06-.15.16-.35.25-.56.25-.18 0-.36-.06-.5-.19ZM8.68 7.26c.41.37.44 1 .07 1.41-.2.22-.47.33-.75.33a.96.96 0 0 1-.67-.26c-.41-.37-.44-1-.07-1.41.37-.42 1-.45 1.41-.08Zm11.48 1.88c.18-.19.52-.19.7 0 .05.04.09.1.11.16.03.06.04.12.04.19 0 .13-.05.26-.15.35-.09.1-.22.15-.35.15s-.26-.05-.35-.15a.355.355 0 0 1-.11-.16.433.433 0 0 1-.04-.19c0-.13.05-.26.15-.35Zm-4.93-1.86a.75.75 0 1 1 1.059-1.06.75.75 0 0 1-1.059 1.06Z"/></svg></button></div><script>(function(win) {
    if (!document.querySelector('.pcb')) {
        return;
    }

    var cbConfig = {
        behaviour: document.querySelector('.pcb').getAttribute('data-behaviour'),
        behaviourLink: document.querySelector('.pcb').getAttribute('data-behaviour-link'),
        revision: document.querySelector('.pcb').getAttribute('data-revision'),
        configTTL: parseInt(document.querySelector('.pcb').getAttribute('data-config-ttl'), 10),
        debugMode: document.querySelector('.pcb').getAttribute('data-debug-mode') === 'true',
        initialState: null,
        initialLsState: null,
        previouslyAccepted: []
    };

    var cbUI = {
        wrapper: document.querySelector('.pcb'),
        banner: {
            element: null,
            btnAccept: null,
            btnReject: null,
            btnConfigure: null
        },
        popup: {
            element: null,
            btnClose: null,
            btnSave: null,
            btnAccept: null,
            btnReject: null,
            checkboxes: null,
        },
        overlay: null,
        badge: null,
        blockedScripts: document.querySelectorAll('script[type^="gdpr-blocker/"]'),
        triggerLinks: cbConfig.behaviourLink ? document.querySelectorAll('a[href*="' + cbConfig.behaviourLink + '"]') : null
    };

    function initUI () {
        // setup banner elements
        cbUI.banner.element = cbUI.wrapper.querySelector('.pcb__banner');
        cbUI.banner.btnAccept = cbUI.banner.element.querySelector('.pcb__btn--accept');
        cbUI.banner.btnReject = cbUI.banner.element.querySelector('.pcb__btn--reject');
        cbUI.banner.btnConfigure = cbUI.banner.element.querySelector('.pcb__btn--configure');

        // setup popup elements
        if (cbUI.wrapper.querySelector('.pcb__popup')) {
            cbUI.popup.element = cbUI.wrapper.querySelector('.pcb__popup');
            cbUI.popup.btnClose = cbUI.wrapper.querySelector('.pcb__popup__close');
            cbUI.popup.btnSave = cbUI.popup.element.querySelector('.pcb__btn--save');
            cbUI.popup.btnAccept = cbUI.popup.element.querySelector('.pcb__btn--accept');
            cbUI.popup.btnReject = cbUI.popup.element.querySelector('.pcb__btn--reject');
            cbUI.popup.checkboxes = cbUI.popup.element.querySelector('input[type="checkbox"]');
            // setup overlay
            cbUI.overlay = cbUI.wrapper.querySelector('.pcb__overlay');
        }

        cbUI.badge = cbUI.wrapper.querySelector('.pcb__badge');

        if (cbConfig.behaviour.indexOf('link') > -1) {
            for (var i = 0; i < cbUI.triggerLinks.length; i++) {
                cbUI.triggerLinks[i].addEventListener('click', function(e) {
                    e.preventDefault();
                    showBannerOrPopup();
                });
            }
        }
    }

    function initState () {
        var lsKeyName = getConfigName();
        var currentConfig = localStorage.getItem(lsKeyName);
        var configIsFresh = checkIfConfigIsFresh();

        if (!configIsFresh || currentConfig === null) {
            if (cbConfig.debugMode) {
                console.log('🍪 Config not found, or configuration expired');
            }

            if (window.publiiCBGCM) {
                gtag('consent', 'default', {
                    'ad_storage': window.publiiCBGCM.defaultState.ad_storage ? 'granted' : 'denied',
                    'ad_personalization': window.publiiCBGCM.defaultState.ad_personalization ? 'granted' : 'denied',
                    'ad_user_data': window.publiiCBGCM.defaultState.ad_user_data ? 'granted' : 'denied',
                    'analytics_storage': window.publiiCBGCM.defaultState.analytics_storage ? 'granted' : 'denied',
                    'personalization_storage': window.publiiCBGCM.defaultState.personalization_storage ? 'granted' : 'denied',
                    'functionality_storage': window.publiiCBGCM.defaultState.functionality_storage ? 'granted' : 'denied',
                    'security_storage': window.publiiCBGCM.defaultState.security_storage ? 'granted' : 'denied'
                });  
                
                if (cbConfig.debugMode) {
                    console.log('🍪 GCMv2 DEFAULT STATE: ' + JSON.stringify({
                        'ad_storage': window.publiiCBGCM.defaultState.ad_storage ? 'granted' : 'denied',
                        'ad_personalization': window.publiiCBGCM.defaultState.ad_personalization ? 'granted' : 'denied',
                        'ad_user_data': window.publiiCBGCM.defaultState.ad_user_data ? 'granted' : 'denied',
                        'analytics_storage': window.publiiCBGCM.defaultState.analytics_storage ? 'granted' : 'denied',
                        'personalization_storage': window.publiiCBGCM.defaultState.personalization_storage ? 'granted' : 'denied',
                        'functionality_storage': window.publiiCBGCM.defaultState.functionality_storage ? 'granted' : 'denied',
                        'security_storage': window.publiiCBGCM.defaultState.security_storage ? 'granted' : 'denied'
                    }));
                }
            }

            showBanner();
        } else if (typeof currentConfig === 'string') {
            if (cbConfig.debugMode) {
                console.log('🍪 Config founded');
            }

            cbConfig.initialLsState = currentConfig.split(',');

            if (window.publiiCBGCM) {
                gtag('consent', 'default', {
                    'ad_storage': getDefaultConsentState(currentConfig, 'ad_storage'),
                    'ad_personalization': getDefaultConsentState(currentConfig, 'ad_personalization'),
                    'ad_user_data': getDefaultConsentState(currentConfig, 'ad_user_data'),
                    'analytics_storage': getDefaultConsentState(currentConfig, 'analytics_storage'),
                    'personalization_storage': getDefaultConsentState(currentConfig, 'personalization_storage'),
                    'functionality_storage': getDefaultConsentState(currentConfig, 'functionality_storage'),
                    'security_storage': getDefaultConsentState(currentConfig, 'security_storage')
                });
                
                if (cbConfig.debugMode) {
                    console.log('🍪 GCMv2 DEFAULT STATE: ' + JSON.stringify({
                        'ad_storage': getDefaultConsentState(currentConfig, 'ad_storage'),
                        'ad_personalization': getDefaultConsentState(currentConfig, 'ad_personalization'),
                        'ad_user_data': getDefaultConsentState(currentConfig, 'ad_user_data'),
                        'analytics_storage': getDefaultConsentState(currentConfig, 'analytics_storage'),
                        'personalization_storage': getDefaultConsentState(currentConfig, 'personalization_storage'),
                        'functionality_storage': getDefaultConsentState(currentConfig, 'functionality_storage'),
                        'security_storage': getDefaultConsentState(currentConfig, 'security_storage')
                    }));
                }
            }

            showBadge();

            if (cbUI.popup.element) {
                var allowedGroups = currentConfig.split(',');
                var checkedCheckboxes = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');

                for (var j = 0; j < checkedCheckboxes.length; j++) {
                    var name = checkedCheckboxes[j].getAttribute('data-group-name');

                    if (name && name !== '-' && allowedGroups.indexOf(name) === -1) {
                        checkedCheckboxes[j].checked = false;
                    }
                }

                for (var i = 0; i < allowedGroups.length; i++) {
                    var checkbox = cbUI.popup.element.querySelector('input[type="checkbox"][data-group-name="' + allowedGroups[i] + '"]');

                    if (checkbox) {
                        checkbox.checked = true;
                    }

                    allowCookieGroup(allowedGroups[i]);
                }
            }
        }

        setTimeout(function () {
            cbConfig.initialState = getInitialStateOfConsents();
        }, 0);
    }

    function checkIfConfigIsFresh () {
        var lastConfigSave = localStorage.getItem('publii-gdpr-cookies-config-save-date');

        if (lastConfigSave === null) {
            return false;
        }

        lastConfigSave = parseInt(lastConfigSave, 10);

        if (lastConfigSave === 0) {
            return true;
        }

        if (+new Date() - lastConfigSave < cbConfig.configTTL * 24 * 60 * 60 * 1000) {
            return true;
        }

        return false;
    }

    function getDefaultConsentState (currentConfig, consentGroup) {
        let configGroups = currentConfig.split(',');

        for (let i = 0; i < configGroups.length; i++) {
            let groupName = configGroups[i];
            let group = window.publiiCBGCM.groups.find(group => group.cookieGroup === groupName);

            if (group && group[consentGroup]) {
                return 'granted';
            }
        }  
        
        if (window.publiiCBGCM.defaultState[consentGroup]) {
            return 'granted'; 
        }
        
        return 'denied';
    }

    function initBannerEvents () {
        cbUI.banner.btnAccept.addEventListener('click', function (e) {
            e.preventDefault();
            acceptAllCookies('banner');
            showBadge();
        }, false);

        if (cbUI.banner.btnReject) {
            cbUI.banner.btnReject.addEventListener('click', function (e) {
                e.preventDefault();
                rejectAllCookies();
                showBadge();
            }, false);
        }

        if (cbUI.banner.btnConfigure) {
            cbUI.banner.btnConfigure.addEventListener('click', function (e) {
                e.preventDefault();
                hideBanner();
                showAdvancedPopup();
                showBadge();
            }, false);
        }
    }

    function initPopupEvents () {
        if (!cbUI.popup.element) {
            return;
        }

        cbUI.overlay.addEventListener('click', function (e) {
            hideAdvancedPopup();
        }, false);

        cbUI.popup.element.addEventListener('click', function (e) {
            e.stopPropagation();
        }, false);

        cbUI.popup.btnAccept.addEventListener('click', function (e) {
            e.preventDefault();
            acceptAllCookies('popup');
        }, false);

        cbUI.popup.btnReject.addEventListener('click', function (e) {
            e.preventDefault();
            rejectAllCookies();
        }, false);

        cbUI.popup.btnSave.addEventListener('click', function (e) {
            e.preventDefault();
            saveConfiguration();
        }, false);

        cbUI.popup.btnClose.addEventListener('click', function (e) {
            e.preventDefault();
            hideAdvancedPopup();
        }, false);
    }

    function initBadgeEvents () {
        if (!cbUI.badge) {
            return;
        }

        cbUI.badge.addEventListener('click', function (e) {
            showBannerOrPopup();
        }, false);
    }

    initUI();
    initState();
    initBannerEvents();
    initPopupEvents();
    initBadgeEvents();

    /**
     * API
     */
    function addScript (src, inline) {
        var newScript = document.createElement('script');

        if (src) {
            newScript.setAttribute('src', src);
        }

        if (inline) {
            newScript.text = inline;
        }

        document.body.appendChild(newScript);
    }

    function allowCookieGroup (allowedGroup) {
        var scripts = document.querySelectorAll('script[type="gdpr-blocker/' + allowedGroup + '"]');
        cbConfig.previouslyAccepted.push(allowedGroup);
    
        for (var j = 0; j < scripts.length; j++) {
            addScript(scripts[j].src, scripts[j].text);
        }

        var groupEvent = new Event('publii-cookie-banner-unblock-' + allowedGroup);
        document.body.dispatchEvent(groupEvent);
        unlockEmbeds(allowedGroup);

        if (cbConfig.debugMode) {
            console.log('🍪 Allowed group: ' + allowedGroup);
        }

        if (window.publiiCBGCM && (!cbConfig.initialLsState || cbConfig.initialLsState.indexOf(allowedGroup) === -1)) {
            let consentResult = {};
            let group = window.publiiCBGCM.groups.find(group => group.cookieGroup === allowedGroup);

            if (group) {
                let foundSomeConsents = false;

                Object.keys(group).forEach(key => {
                    if (key !== 'cookieGroup' && group[key] === true) {
                        consentResult[key] = 'granted';
                        foundSomeConsents = true;
                    }
                });

                if (foundSomeConsents) {
                    gtag('consent', 'update', consentResult);   

                    if (cbConfig.debugMode) {
                        console.log('🍪 GCMv2 UPDATE: ' + JSON.stringify(consentResult));
                    }
                }
            }
        }
    }

    function showBannerOrPopup () {
        if (cbUI.popup.element) {
            showAdvancedPopup();
        } else {
            showBanner();
        }
    }

    function showAdvancedPopup () {
        cbUI.popup.element.classList.add('is-visible');
        cbUI.overlay.classList.add('is-visible');
        cbUI.popup.element.setAttribute('aria-hidden', 'false');
        cbUI.overlay.setAttribute('aria-hidden', 'false');
    }

    function hideAdvancedPopup () {
        cbUI.popup.element.classList.remove('is-visible');
        cbUI.overlay.classList.remove('is-visible');
        cbUI.popup.element.setAttribute('aria-hidden', 'true');
        cbUI.overlay.setAttribute('aria-hidden', 'true');
    }

    function showBanner () {
        cbUI.banner.element.classList.add('is-visible');
        cbUI.banner.element.setAttribute('aria-hidden', 'false');
    }

    function hideBanner () {
        cbUI.banner.element.classList.remove('is-visible');
        cbUI.banner.element.setAttribute('aria-hidden', 'true');
    }

    function showBadge () {
        if (!cbUI.badge) {
            return;
        }

        cbUI.badge.classList.add('is-visible');
        cbUI.badge.setAttribute('aria-hidden', 'false');
    }

    function getConfigName () {
        var lsKeyName = 'publii-gdpr-allowed-cookies';

        if (cbConfig.revision) {
            lsKeyName = lsKeyName + '-v' + parseInt(cbConfig.revision, 10);
        }

        return lsKeyName;
    }

    function storeConfiguration (allowedGroups) {
        var lsKeyName = getConfigName();
        var dataToStore = allowedGroups.join(',');
        localStorage.setItem(lsKeyName, dataToStore);

        if (cbConfig.configTTL === 0) {
            localStorage.setItem('publii-gdpr-cookies-config-save-date', 0);

            if (cbConfig.debugMode) {
                console.log('🍪 Store never expiring configuration');
            }
        } else {
            localStorage.setItem('publii-gdpr-cookies-config-save-date', +new Date());
        }
    }

    function getInitialStateOfConsents () {
        if (!cbUI.popup.element) {
            return [];
        }

        var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');
        var groups = [];

        for (var i = 0; i < checkedGroups.length; i++) {
            var allowedGroup = checkedGroups[i].getAttribute('data-group-name');

            if (allowedGroup !== '') {
                groups.push(allowedGroup);
            }
        }

        if (cbConfig.debugMode) {
            console.log('🍪 Initial state: ' + groups.join(', '));
        }

        return groups;
    }

    function getCurrentStateOfConsents () {
        if (!cbUI.popup.element) {
            return [];
        }

        var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');
        var groups = [];

        for (var i = 0; i < checkedGroups.length; i++) {
            var allowedGroup = checkedGroups[i].getAttribute('data-group-name');

            if (allowedGroup !== '') {
                groups.push(allowedGroup);
            }
        }

        if (cbConfig.debugMode) {
            console.log('🍪 State to save: ' + groups.join(', '));
        }

        return groups;
    }

    function getAllGroups () {
        if (!cbUI.popup.element) {
            return [];
        }

        var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]');
        var groups = [];

        for (var i = 0; i < checkedGroups.length; i++) {
            var allowedGroup = checkedGroups[i].getAttribute('data-group-name');

            if (allowedGroup !== '') {
                groups.push(allowedGroup);
            }
        }

        return groups;
    }

    function acceptAllCookies (source) {
        var groupsToAccept = getAllGroups();
        storeConfiguration(groupsToAccept);

        for (var i = 0; i < groupsToAccept.length; i++) {
            var group = groupsToAccept[i];

            if (cbConfig.initialState.indexOf(group) > -1 || cbConfig.previouslyAccepted.indexOf(group) > -1) {
                if (cbConfig.debugMode) {
                    console.log('🍪 Skip previously activated group: ' + group);
                }

                continue;
            }

            allowCookieGroup(group);
        }

        if (cbUI.popup.element) {
            var checkboxesToCheck = cbUI.popup.element.querySelectorAll('input[type="checkbox"]');

            for (var j = 0; j < checkboxesToCheck.length; j++) {
                checkboxesToCheck[j].checked = true;
            }
        }

        if (cbConfig.debugMode) {
            console.log('🍪 Accept all cookies: ', groupsToAccept.join(', '));
        }

        if (source === 'popup') {
            hideAdvancedPopup();
        } else if (source === 'banner') {
            hideBanner();
        }
    }

    function rejectAllCookies () {
        if (cbConfig.debugMode) {
            console.log('🍪 Reject all cookies');
        }

        storeConfiguration([]);
        setTimeout(function () {
            window.location.reload();
        }, 100);
    }

    function saveConfiguration () {
        var groupsToAccept = getCurrentStateOfConsents();
        storeConfiguration(groupsToAccept);

        if (cbConfig.debugMode) {
            console.log('🍪 Save new config: ', groupsToAccept.join(', '));
        }

        if (reloadIsNeeded(groupsToAccept)) {
            setTimeout(function () {
                window.location.reload();
            }, 100);
            return;
        }

        for (var i = 0; i < groupsToAccept.length; i++) {
            var group = groupsToAccept[i];

            if (cbConfig.initialState.indexOf(group) > -1 || cbConfig.previouslyAccepted.indexOf(group) > -1) {
                if (cbConfig.debugMode) {
                    console.log('🍪 Skip previously activated group: ' + group);
                }

                continue;
            }

            allowCookieGroup(group);
        }

        hideAdvancedPopup();
    }

    function reloadIsNeeded (groupsToAccept) {
        // check if user rejected consent for initial groups
        var initialGroups = cbConfig.initialState;
        var previouslyAcceptedGroups = cbConfig.previouslyAccepted;
        var groupsToCheck = initialGroups.concat(previouslyAcceptedGroups);

        for (var i = 0; i < groupsToCheck.length; i++) {
            var groupToCheck = groupsToCheck[i];

            if (groupToCheck !== '' && groupsToAccept.indexOf(groupToCheck) === -1) {
                if (cbConfig.debugMode) {
                    console.log('🍪 Reload is needed due lack of: ', groupToCheck);
                }

                return true;
            }
        }

        return false;
    }

    function unlockEmbeds (cookieGroup) {
        var iframesToUnlock = document.querySelectorAll('.pec-wrapper[data-consent-group-id="' + cookieGroup + '"]');

        for (var i = 0; i < iframesToUnlock.length; i++) {
            var iframeWrapper = iframesToUnlock[i];
            iframeWrapper.querySelector('.pec-overlay').classList.remove('is-active');
            iframeWrapper.querySelector('.pec-overlay').setAttribute('aria-hidden', 'true');
            var iframe = iframeWrapper.querySelector('iframe');
            iframe.setAttribute('src', iframe.getAttribute('data-consent-src'));
        }
    }

    win.publiiEmbedConsentGiven = function (cookieGroup) {
        // it will unlock embeds
        allowCookieGroup(cookieGroup);

        var checkbox = cbUI.popup.element.querySelector('input[type="checkbox"][data-group-name="' + cookieGroup + '"]');

        if (checkbox) {
            checkbox.checked = true;
        }

        var groupsToAccept = getCurrentStateOfConsents();
        storeConfiguration(groupsToAccept);

        if (cbConfig.debugMode) {
            console.log('🍪 Save new config: ', groupsToAccept.join(', '));
        }
    }
})(window);</script></body></html>